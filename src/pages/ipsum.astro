---
import Layout from '../layouts/Layout.astro';
import { generateKotlettIpsumWithOptions } from '../services/kotlettIpsumGenerator';

const initialText = generateKotlettIpsumWithOptions({ paragraphs: 3, sentences: 5 });
---

<Layout title="Kotlett Ipsum - Svenska Fyllnadstexter">
    <div class="container">
        <h1>Kotlett Ipsum</h1>
        <p class="subtitle">Svenska fyllnadstexter om den bästa köttsorten</p>

        <div class="controls">
            <div class="control-group">
                <label for="sentences">Antal meningar per stycke</label>
                <div class="slider-container">
                    <input type="range" id="sentences" min="3" max="10" value="5">
                    <span class="value-display" id="sentencesValue">5</span>
                </div>
            </div>

            <div class="control-group">
                <label for="paragraphs">Antal stycken</label>
                <div class="slider-container">
                    <input type="range" id="paragraphs" min="1" max="10" value="3">
                    <span class="value-display" id="paragraphsValue">3</span>
                </div>
            </div>
        </div>

        <textarea id="output" readonly>{initialText}</textarea>
        <button class="copy-btn" id="copyBtn">Kopiera till urklipp</button>

        <div class="api-info">
            <h2>API för kotlettutvecklare</h2>
            <p>Du kan använda vårt API för att generera kotlett ipsum programmatiskt:</p>

            <code class="api-url" id="apiUrl">https://kotlett.se/api/ipsum?paragraphs=3&sentences=5&format=json</code>

            <button class="copy-btn api-copy-button" id="apiCopyBtn">Kopiera API URL</button>

            <div class="api-params">
                <h3>Parametrar:</h3>
                <ul>
                    <li><strong>paragraphs</strong> - Antal stycken (1-10, standard: 3)</li>
                    <li><strong>sentences</strong> - Antal meningar per stycke (3-10, standard: 5)</li>
                    <li><strong>format</strong> - Svarsformat: text, json eller html (standard: text)</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const words = [
            'kotlett', 'fläskkarré', 'revbensspjäll', 'entrecôte', 'oxfilé', 'fläskfilé',
            'korv', 'falukorv', 'grillkorv', 'prinskorv', 'isterband', 'medwurst',
            'köttfärs', 'bacon', 'skinka', 'lufttorkad skinka', 'rökt skinka',
            'fläskkött', 'nötkött', 'kalvkött', 'lamm', 'älgkött', 'renkött',
            'fläsklägg', 'rökt sidfläsk', 'kassler', 'schnitzel', 'biff', 'hamburgare',
            'grillad', 'stekt', 'kokt', 'rökt', 'marinerad', 'kryddad',
            'saftig', 'mör', 'smakrik', 'välstekt', 'läcker', 'gyllenbrun',
            'senap', 'pepparrot', 'pressad gurka', 'rödkål', 'gräddsås', 'bearnaisesås',
            'potatismos', 'rostad lök', 'vitlök', 'timjan', 'rosmarin', 'peppar',
            'havet salt', 'kryddsmör', 'grillkrydda', 'soja', 'honung', 'BBQ-sås',
            'panna', 'ugn', 'grill', 'stekpanna', 'gryta', 'långkok',
            'medelstekt', 'välstekt', 'blodig', 'rosa', 'genomstekt', 'lättstekt',
            'strimlad', 'tärnad', 'skivad', 'hackad', 'delad', 'fileerad',
            'frasig', 'krispig', 'gyllene', 'smarrig', 'mustigt', 'fylligt',
            'rostbiff', 'köttbullar', 'frikadeller', 'pyttipanna', 'wallenbergare', 'falukorv',
            'fläskpannkaka', 'blodpudding', 'leverpastej', 'sylta', 'rullsylta', 'pressylta',
            'flintastek', 'skinkstek', 'picnicbog', 'högrev', 'innanlår', 'fransyska', 'ytterlår',
            'clubstek', 'T-benstek', 'bringa', 'kind', 'bog', 'rulle', 'rostas', 'biffstock', 
            'ankarstock','panerad', 'dubbelpanerad', 'bräserad', 'långbakad', 'rimmad', 'gravad', 
            'wokat', 'helstekt', 'bankad', 'lättgravad', 'halstrad','knaprig', 'karamelliserad', 
            'välhängd', 'smörstekt', 'lågtempad', 'benfri', 'med ben', 'svål', 'fettkant', 'marmorerad',
            'brunsås', 'skysås', 'svampsås', 'kantarellsås', 'rödvinssås', 'pepparsås', 'choronsås', 
            'äppelmos', 'lingonsylt', 'svartvinbärsgelé', 'rönnbärsgelé', 'picklad rödlök', 
            'saltgurka', 'inlagd gurka', 'hasselbackspotatis', 'klyftpotatis', 'potatisgratäng', 
            'stompad potatis', 'rotfruktsgratäng', 'råstekt potatis', 'pommes frites',
        ];

        const starters = [
            'Kotlett ipsum dolor amet',
            'Kotlett mör saftig grillad',
            'Kotlett väldoftande stekt',
            'Kotlett gyllenbrun krispig',
            'Kotlett mustigt kryddad',
            'Kotlett läcker marinerad',
            'Kotlett smakrik genomstekt',
            'Kotlett med svål och sälta',
            'Kotlett panerad i rikligt smör',
            'Kotlett direkt från charken',
            'Kotlett nystekt och rykande',
            'Kotlett dränkt i gräddsås',
            'Kotlett med frasig yta',
            'Kotlett, husmanskostens hjälte',
            'Kotlett saltad och pepprad',
            'Kotlett serverad med kärlek',
            'Kotlett direkt från pannan',
            'Kotlett med en klick smör',
            'Kotlett, sås och potatis',
            'Kotlett till vardag och fest'
        ];

        function getRandomWord(): string {
            return words[Math.floor(Math.random() * words.length)];
        }

        function capitalize(str: string): string {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        function generateSentence(isFirst: boolean = false): string {
            const wordCount = Math.floor(Math.random() * 8) + 8; // 8-15 words
            let sentence: string[] = [];

            if (isFirst) {
                sentence.push(starters[Math.floor(Math.random() * starters.length)]);
            } else {
                sentence.push(capitalize(getRandomWord()));
            }

            for (let i = 0; i < wordCount - (isFirst ? starters[0].split(' ').length : 1); i++) {
                sentence.push(getRandomWord());
            }

            return sentence.join(' ') + '.';
        }

        function generateParagraph(sentenceCount: number, isFirstParagraph: boolean = false): string {
            const sentences: string[] = [];
            for (let i = 0; i < sentenceCount; i++) {
                sentences.push(generateSentence(isFirstParagraph && i === 0));
            }
            return sentences.join(' ');
        }

        function generateText(paragraphCount: number, sentencesPerParagraph: number): string {
            const paragraphs: string[] = [];
            for (let i = 0; i < paragraphCount; i++) {
                paragraphs.push(generateParagraph(sentencesPerParagraph, i === 0));
            }
            return paragraphs.join('\n\n');
        }

        function updateText() {
            const sentencesEl = document.getElementById('sentences') as HTMLInputElement | null;
            const paragraphsEl = document.getElementById('paragraphs') as HTMLInputElement | null;
            const outputEl = document.getElementById('output') as HTMLTextAreaElement | null;

            if (!sentencesEl || !paragraphsEl || !outputEl) return;

            const sentenceCount = parseInt(sentencesEl.value);
            const paragraphCount = parseInt(paragraphsEl.value);

            const text = generateText(paragraphCount, sentenceCount);
            outputEl.value = text;
        }

        // Event listeners for sliders
        const sentencesSlider = document.getElementById('sentences');
        const paragraphsSlider = document.getElementById('paragraphs');
        const sentencesValue = document.getElementById('sentencesValue');
        const paragraphsValue = document.getElementById('paragraphsValue');

        if (sentencesSlider && sentencesValue) {
            sentencesSlider.addEventListener('input', (e) => {
                sentencesValue.textContent = (e.target as HTMLInputElement).value;
                updateText();
            });
        }

        if (paragraphsSlider && paragraphsValue) {
            paragraphsSlider.addEventListener('input', (e) => {
                paragraphsValue.textContent = (e.target as HTMLInputElement).value;
                updateText();
            });
        }

        // Copy to clipboard functionality
        const copyBtn = document.getElementById('copyBtn');
        if (copyBtn) {
            copyBtn.addEventListener('click', async () => {
                const output = document.getElementById('output') as HTMLTextAreaElement | null;
                if (!output) return;

                try {
                    await navigator.clipboard.writeText(output.value);
                    copyBtn.textContent = '✓ Kopierat!';
                    copyBtn.classList.add('copied');

                    setTimeout(() => {
                        copyBtn.textContent = 'Kopiera till urklipp';
                        copyBtn.classList.remove('copied');
                    }, 2000);
                } catch (err) {
                    // Fallback for older browsers
                    output.select();
                    document.execCommand('copy');
                    copyBtn.textContent = '✓ Kopierat!';
                    copyBtn.classList.add('copied');

                    setTimeout(() => {
                        copyBtn.textContent = 'Kopiera till urklipp';
                        copyBtn.classList.remove('copied');
                    }, 2000);
                }
            });
        }

        // Generate initial text
        updateText();

        // API URL copy functionality
        const apiCopyBtn = document.getElementById('apiCopyBtn');
        if (apiCopyBtn) {
            apiCopyBtn.addEventListener('click', async () => {
                const apiUrlEl = document.getElementById('apiUrl') as HTMLElement | null;
                if (!apiUrlEl) return;

                const apiUrl = apiUrlEl.textContent || '';

                try {
                    await navigator.clipboard.writeText(apiUrl);
                    apiCopyBtn.textContent = '✓ Kopierat!';
                    apiCopyBtn.classList.add('copied');

                    setTimeout(() => {
                        apiCopyBtn.textContent = 'Kopiera API URL';
                        apiCopyBtn.classList.remove('copied');
                    }, 2000);
                } catch (err) {
                    console.error('Failed to copy:', err);
                }
            });
        }
    </script>
</Layout>
